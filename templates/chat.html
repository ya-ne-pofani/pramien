<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Чат</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <span id="my-username" hidden>{{ user.username }}</span>
    <span id="my-nickname" hidden>{{ user.nickname }}</span>
    <span id="my-handle" hidden>{{ user.handle }}</span>
    <span id="my-color" hidden>{{ user.avatar_color }}</span>
    <span id="my-emoji" hidden>{{ user.avatar_emoji }}</span>
    <span id="my-bio" hidden>{{ user.bio or '' }}</span>

    <div class="app">
        <div class="nav">
            <div class="nav-group">
                <button class="nav-btn active" data-tab="home" title="Главная"><i class="fas fa-home"></i></button>
                <button class="nav-btn" data-tab="chats" title="Чаты"><i class="fas fa-comment-alt"></i></button>
                <a href="/games" class="nav-btn" title="Игры"><i class="fas fa-gamepad"></i></a>
            </div>
            <div class="nav-group desktop-only">
                <button class="nav-btn" id="settings-btn" title="Настройки"><i class="fas fa-cog"></i></button>
                <div class="nav-avatar" id="profile-btn" title="Профиль" style="background-color: {{ user.avatar_color }};">
                    <span>{{ user.avatar_emoji }}</span>
                </div>
                <button class="nav-btn" id="logout-btn" title="Выход"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>

        <div class="main">
            <div id="tab-home" class="app-tab active">
                <div style="font-size: 4rem; color: #333; margin-bottom: 20px;"><i class="fas fa-robot"></i></div>
                <h1 style="color:var(--primary); margin-bottom:10px;">Привет, {{ user.nickname }}!</h1>
                <p style="color:#888;">Выбери чат слева или сыграй в игры.</p>
            </div>
            
            <div id="tab-chats" class="app-tab">
                <div class="chat-list">
                    <div class="header">
                        <span>Сообщения</span>
                        <i class="fas fa-edit" style="color:#888; cursor:pointer;"></i>
                    </div>
                    <div style="overflow-y:auto; flex:1;">
                        <div id="chat-list">
                            <div class="item active" id="global-chat" data-room="#Global">
                                <div class="ava" style="background:#555"><i class="fas fa-globe"></i></div>
                                <div class="chat-info"><span>Общий чат</span><small>Сервер</small></div>
                            </div>
                        </div>
                        <div style="padding: 15px 10px 5px; color:#666; font-size:0.75rem; text-transform:uppercase; font-weight:bold;">Пользователи</div>
                        <div id="user-list"></div>
                    </div>
                </div>
            
                <div class="chat-window" id="chat-window">
                    <div class="header" id="chat-header">
                        <i class="fas fa-arrow-left mobile-only" onclick="closeChat()" style="margin-right:15px; font-size:1.2rem; color:#888;"></i>
                        <div id="header-avatar" class="ava" style="width:38px; height:38px; font-size:1.2rem; margin-right:12px; display:none;"><span></span></div>
                        <div style="display:flex; flex-direction:column;">
                            <span id="chat-title">Выберите чат</span>
                            <small id="chat-status" style="font-weight: 500; color:#888; font-size: 0.75rem;"></small>
                        </div>
                    </div>
                    
                    <div class="msgs" id="msgs"></div>
                    
                    <div id="reply-bar" style="display:none; padding: 10px 20px; background: var(--panel); border-bottom:1px solid var(--border);">
                        <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                            <div style="border-left:3px solid var(--primary); padding-left:10px;">
                                <div style="font-size:0.8rem; color:var(--primary)">Ответ на: <span id="reply-nick"></span></div>
                                <div style="font-size:0.8rem; color:#aaa; max-width:250px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;" id="reply-content"></div>
                            </div>
                            <i class="fas fa-times" style="font-size:1.2rem; color:#888; cursor:pointer;" id="cancel-reply-btn"></i>
                        </div>
                    </div>

                    <div class="input-area">
                        <div class="input-area-controls">
                            <input type="text" id="msg-input" placeholder="Написать сообщение..." autocomplete="off">
                            <button class="send-btn" id="send-btn"><i class="fas fa-paper-plane" style="font-size:1rem;"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <button class="close-btn" data-close="profile-modal">&times;</button>
            <button class="modal-action-btn" id="edit-icon-btn" title="Редактировать"><i class="fas fa-pencil-alt"></i></button>
            <div style="text-align:center; margin:10px 0;">
                <div id="self-avatar-preview" class="ava" style="width:80px; height:80px; font-size:3rem; margin:0 auto;"><span></span></div>
            </div>
            <div id="profile-view">
                <h3 id="view-nickname" style="text-align:center"></h3>
                <p id="view-handle" style="text-align:center; color:#888"></p>
                <p id="view-bio" style="text-align:center; color:#ccc; font-style:italic; margin-bottom:15px;"></p>
            </div>
            <form id="profile-edit-form" style="display:none">
                <div class="form-group"><label>Никнейм</label><input type="text" id="edit-nickname" class="view-input"></div>
                <div class="form-group"><label>@Handle</label><input type="text" id="edit-handle" class="view-input"></div>
                <div class="form-group"><label>О себе</label><textarea id="edit-bio" class="view-input" rows="3"></textarea></div>
                <h4 style="margin-top:15px; color:#ccc; font-size:0.9rem;">Цвет и Аватар</h4>
                <div class="picker-grid" id="edit-color-picker"></div>
                <div class="picker-grid" id="edit-emoji-picker"></div>
                <button type="submit" class="primary-btn">Сохранить</button>
            </form>
        </div>
    </div>

    <div class="modal" id="view-user-modal">
        <div class="modal-content">
            <button class="close-btn" data-close="view-user-modal">&times;</button>
            <div style="text-align:center; margin:20px 0;">
                <div id="user-view-avatar" class="ava" style="width:80px; height:80px; font-size:3rem; margin:0 auto;"><span></span></div>
                <h2 id="user-view-nickname"></h2>
                <p id="user-view-handle" style="color:#888"></p>
                <p id="user-view-bio" style="color:#ccc; font-style:italic; margin-top:10px;"></p>
            </div>
            <button class="primary-btn" id="view-dm-btn"><i class="fas fa-comment"></i> Написать</button>
        </div>
    </div>
    
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <button class="close-btn" data-close="settings-modal">&times;</button>
            <h3>Акцентный цвет</h3>
            <div class="picker-grid" id="theme-picker"></div>
        </div>
    </div>
    <script src="/static/js/chat.js"></script>
</body>
</html>