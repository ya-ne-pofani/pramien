<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pramien</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <div id="app-data" 
         data-username="{{ user.username }}"
         data-nickname="{{ user.nickname }}"
         data-handle="{{ user.handle }}"
         data-color="{{ user.avatar_color }}"
         data-emoji="{{ user.avatar_emoji }}"
         data-bio="{{ user.bio or '' }}"
         data-tags='{{ user.tags | tojson | safe }}'
         hidden></div>

    <div class="app">
        <div class="nav">
            <div class="nav-indicator" id="nav-indicator"></div>
            <div class="nav-group">
                <button class="nav-btn active anim-nav-btn" data-tab="home" title="Главная"><i class="fas fa-home"></i></button>
                <button class="nav-btn anim-nav-btn" data-tab="chats" title="Чаты">
                    <i class="fas fa-comment-alt"></i>
                    <span class="nav-badge" id="total-unread">0</span>
                </button>
                <a href="/games" class="nav-btn anim-nav-btn" title="Игры"><i class="fas fa-gamepad"></i></a>
            </div>
            <div class="nav-group desktop-only">
                <button class="nav-btn anim-nav-btn" id="settings-btn" title="Настройки"><i class="fas fa-cog"></i></button>
                <div class="nav-avatar anim-nav-btn" id="my-avatar-btn" title="Мой профиль" style="background-color: {{ user.avatar_color }};">
                    <span>{{ user.avatar_emoji }}</span>
                </div>
            </div>
        </div>

        <div class="profile-popover" id="profile-popover">
            <div id="popover-view">
                <div class="profile-header">
                    <div class="profile-large-ava" id="pop-ava" style="background-color: {{ user.avatar_color }};">{{ user.avatar_emoji }}</div>
                    <div class="profile-names">
                        <h3 id="pop-nick">{{ user.nickname }}</h3>
                        <div class="tag-pills-container" id="pop-tags"></div>
                        <p id="pop-handle">@{{ user.handle }}</p>
                    </div>
                </div>
                <div class="profile-bio-box" id="pop-bio">{{ user.bio or 'Нет статуса' }}</div>
                <div class="profile-controls">
                    <button class="icon-btn" id="pop-edit-btn" title="Редактировать"><i class="fas fa-pencil-alt"></i></button>
                    <button class="icon-btn logout-icon" id="pop-logout-btn" title="Выйти"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </div>
            <div id="popover-edit" class="edit-form">
                <div style="text-align:center; margin-bottom:10px;">
                    <div id="edit-preview-ava" class="profile-large-ava" style="margin:0 auto;"></div>
                </div>
                
                <label class="input-label">Никнейм</label>
                <input type="text" id="edit-nick-in" class="view-input" maxlength="20">
                
                <label class="input-label">Handle (ID)</label>
                <input type="text" id="edit-handle-in" class="view-input" maxlength="20">
                
                <label class="input-label">О себе</label>
                <textarea id="edit-bio-in" class="view-input" rows="2" maxlength="300"></textarea>
                
                <label class="input-label">Цвет аватара</label>
                <div class="picker-grid" id="pop-color-picker"></div>
                
                <label class="input-label">Эмодзи</label>
                <div class="picker-grid" id="pop-emoji-picker" style="margin-bottom:10px;"></div>
                
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button class="primary-btn" id="pop-save-btn">Сохранить</button>
                    <button class="secondary-btn" id="pop-cancel-btn">Отмена</button>
                </div>
            </div>
        </div>

        <div class="main">
            <div id="tab-home" class="app-tab active">
                <h1 id="welcome-text" style="color:var(--primary); margin-bottom:10px;">Привет, {{ user.nickname }}!</h1>
                <p id="subtitle-text" style="color:#888; height: 1.2em;">Выбери чат слева или сыграй в игры.</p>
            </div>
            
            <div id="tab-chats" class="app-tab">
                <div class="chat-list">
                    <div class="header">
                        <span>Чаты</span>
                        <i class="fas fa-plus" id="create-group-btn" style="color:var(--primary); cursor:pointer; font-size: 1.2rem;" title="Создать группу"></i>
                    </div>
                    <div style="overflow-y:auto; flex:1;">
                        <div id="chat-list-container"></div>
                        <div style="padding: 15px 10px 5px; color:#666; font-size:0.75rem; text-transform:uppercase; font-weight:bold;">Пользователи</div>
                        <div id="user-list"></div>
                    </div>
                </div>
            
                <div class="chat-window empty" id="chat-window">
                    <div class="chat-placeholder">
                        <i class="fas fa-comments"></i>
                        <span>Выберите чат, чтобы начать общение</span>
                    </div>
                    
                    <div class="header" id="chat-header">
                        <i class="fas fa-arrow-left mobile-only" onclick="closeChat()" style="margin-right:15px; font-size:1.2rem; color:#888;"></i>
                        <div id="header-avatar" class="ava" style="width:38px; height:38px; font-size:1.2rem; margin-right:12px; display:none; cursor:pointer;"><span></span></div>
                        <div style="display:flex; flex-direction:column; cursor:pointer;" id="header-info-box">
                            <span id="chat-title"></span>
                            <small id="chat-status" style="font-weight: 500; color:#888; font-size: 0.75rem;"></small>
                        </div>
                    </div>

                    <div class="msgs" id="msgs"></div>
                    <div id="reply-bar" style="display:none; padding: 10px 20px; background: var(--panel); border-bottom:1px solid var(--border);">
                        <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                            <div style="border-left:3px solid var(--primary); padding-left:10px;">
                                <div style="font-size:0.8rem; color:var(--primary)">Ответ на: <span id="reply-nick"></span></div>
                                <div style="font-size:0.8rem; color:#aaa; max-width:250px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;" id="reply-content"></div>
                            </div>
                            <i class="fas fa-times" style="font-size:1.2rem; color:#888; cursor:pointer;" id="cancel-reply-btn"></i>
                        </div>
                    </div>
                    <div class="input-area">
                        <div class="input-area-controls">
                            <input type="text" id="msg-input" placeholder="Написать сообщение..." autocomplete="off">
                            <button class="send-btn" id="send-btn"><i class="fas fa-paper-plane" style="font-size:1rem;"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="view-user-modal">
        <div class="modal-content">
            <button class="close-btn" data-close="view-user-modal">&times;</button>
            <div style="text-align:center; margin:20px 0;">
                <div id="user-view-avatar" class="ava" style="width:80px; height:80px; font-size:3rem; margin:0 auto;"><span></span></div>
                <h2 id="user-view-nickname" style="display:flex; justify-content:center; align-items:center; gap:5px; margin-top:10px;"></h2>
                <div class="tag-pills-container" id="user-view-tags"></div>
                <p id="user-view-handle" style="color:#888; margin-top:5px;"></p>
                <p id="user-view-bio" style="color:#ccc; font-style:italic; margin-top:15px; background:rgba(255,255,255,0.05); padding:10px; border-radius:8px;"></p>
            </div>
            <button class="primary-btn" id="view-dm-btn"><i class="fas fa-comment"></i> Написать</button>
        </div>
    </div>
    
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <button class="close-btn" data-close="settings-modal">&times;</button>
            <h3>Акцентный цвет</h3>
            <div class="picker-grid" id="theme-picker"></div>
        </div>
    </div>

    <div class="modal" id="create-group-modal">
        <div class="modal-content">
            <button class="close-btn" data-close="create-group-modal">&times;</button>
            <h3>Создать группу</h3>
            <input type="text" id="group-name-input" class="view-input" placeholder="Название группы">
            <p style="font-size:0.9rem; color:#888; margin-bottom:10px;">Выберите участников:</p>
            <div class="user-select-list" id="group-user-select"></div>
            <button class="primary-btn" id="submit-group-btn">Создать</button>
        </div>
    </div>

    <script src="/static/js/chat.js"></script>
</body>
</html>